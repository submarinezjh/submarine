
ChatGPT 说：

好的 👍 我帮你把你前面贴的内容（交叉编译器、头文件路径、源码目录、自动收集源文件）拼成一个完整 Makefile 示例，能自动生成 bsp.elf 和 bsp.bin。

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# ========================
# 工程配置
# ========================
CROSS_COMPILE ?= arm-linux-gnueabihf-
TARGET ?= bsp

CC      := $(CROSS_COMPILE)gcc
LD      := $(CROSS_COMPILE)ld
OBJCOPY := $(CROSS_COMPILE)objcopy
OBJDUMP := $(CROSS_COMPILE)objdump

# 头文件路径
INCDIRS := imx6ul \
           bsp/clk \
           bsp/led \
           bsp/delay

# 源码路径
SRCDIRS := project \
           bsp/clk \
           bsp/led \
           bsp/delay

# 头文件参数 (-I xxx)
INCLUDE := $(patsubst %, -I %, $(INCDIRS))

# ========================
# 自动收集源码
# ========================
SFILES    := $(foreach dir, $(SRCDIRS), $(wildcard $(dir)/*.S))
CFILES    := $(foreach dir, $(SRCDIRS), $(wildcard $(dir)/*.c))

SFILENDIR := $(notdir $(SFILES))
CFILENDIR := $(notdir $(CFILES))

SOBJS     := $(patsubst %, obj/%, $(SFILENDIR:.S=.o))
COBJS     := $(patsubst %, obj/%, $(CFILENDIR:.c=.o))
OBJS      := $(SOBJS) $(COBJS)

# 让 make 能在这些目录里找到源文件
VPATH := $(SRCDIRS)

# ========================
# 编译参数
# ========================
CFLAGS := -Wall -O2 -fno-builtin $(INCLUDE)
LDFLAGS := -T imx6ul.lds   # 你的链接脚本文件

# ========================
# 规则
# ========================

# 默认目标：生成 elf 和 bin
all: $(TARGET).elf $(TARGET).bin

# 链接生成 elf
$(TARGET).elf: $(OBJS)
	$(CC) -o $@ $^ $(LDFLAGS)

# 转换成 bin
$(TARGET).bin: $(TARGET).elf
	$(OBJCOPY) -O binary $< $@

# 生成反汇编文件（可选）
$(TARGET).dis: $(TARGET).elf
	$(OBJDUMP) -D $< > $@

# 汇编源文件规则
obj/%.o: %.S
	@mkdir -p obj
	$(CC) $(CFLAGS) -c -o $@ $<

# C 源文件规则
obj/%.o: %.c
	@mkdir -p obj
	$(CC) $(CFLAGS) -c -o $@ $<

# 清理
clean:
	rm -rf obj *.elf *.bin *.dis

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

用法

把这个文件保存为 Makefile。

你的工程目录结构大致是：

imx6ul/        (头文件)
bsp/clk/       (clk.c, clk.h)
bsp/led/       (led.c, led.h)
bsp/delay/     (delay.c, delay.h)
project/       (main.c)
imx6ul.lds     (链接脚本)


执行：

make


会生成：

bsp.elf

bsp.bin

bsp.dis（如果执行 make bsp.dis）